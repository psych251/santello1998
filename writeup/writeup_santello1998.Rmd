---
title: "Replication of Postural Hand Synergies for Tool Use by Santello, Flanders and Soechting (1998, Journal of Neuroscience)"
author: "Shivani Guptasarma (shivanig@stanford.edu)"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: false
---

<!-- Replication reports should all use this template to standardize reporting across projects.  These reports will be public supplementary materials that accompany the summary report(s) of the aggregate results. -->

## Introduction

A study was performed by Santello *et al.* in 1998 to investigate whether grasping postures showed natural patterns of coordination between the many joints of the human hand. Participants were asked to grasp imaginary objects of diverse shapes with one of their hands. The angles between various segments of the hand were measured with a tracking glove, and analyzed to identify ``postural synergies". This report documents a replication of the 1998 study, using  visual tracking of the hand with a wearable headset. The key analysis of interest of the replication is a **principal component analysis** (PCA) of the joint angles data from grasping of a number of geometries. An important finding of the original paper was that the first two principal components account for more than 80% of the variance in posture.

While a goal of the original experiment was to better understand the neuromuscular basis of movement, its results have proved significant for efficient motion planning in robotic manipulators, as well as for the design and control of prosthetic hands. The choice of this study for replication was motivated by an interest in simplifying the control of prosthetic devices by exploiting an understanding of the neural control of movement. 

It was anticipated that the use of visual tracking might lead to less accurate data for fingers which were partially or completely occluded from the camera. Since the stimuli were entirely verbal, it was likely that different subjects would interpret them differently based on their own imagined shape and size of each object. Finally, owing to a lack of experience with implementation, minor challenges were expected in obtaining joint angle data in a usable form from a proprietary headset, and performing a PCA in the chosen computing environment.

Project repository: [https://github.com/psych251/santello1998](https://github.com/psych251/santello1998)

Original paper: [https://github.com/psych251/santello1998/blob/main/original_paper/Santello1998_postural_synergies.pdf](https://github.com/psych251/santello1998/blob/main/original_paper/Santello1998_postural_synergies.pdf)


## Methods

<!--
### Power Analysis

Original effect size, power analysis for samples to achieve 80%, 90%, 95% power to detect that effect size.  Considerations of feasibility for selecting planned sample size.-->

### Planned Sample

The sample of the original study as well as the replication was 5 right-handed participants. The age range of the original subjects was 30-41 years, while the replication used subjects of ages 22-30 years. 
<!--Planned sample size and/or termination rule, sampling frame, known demographics if any, preselection rules if any.-->

### Materials

The original paper used a Cyberglove hand-tracking device while the replication used a Microsoft Hololens 2. A keyboard was used in place of a contact switch to register the completion of the grasping task.

<!--All materials - can quote directly from original article - just put the text in quotations and note that this was followed precisely.  Or, quote directly and just point out exceptions to what was described in the original article.-->

### Procedure	

"Subjects were instructed to shape the right hand to grasp and use a large number of imagined objects (n = 57; Table 1). They were encouraged to move the proximal arm in tandem with the hand motion. An object was named at the beginning of each trial. We selected objects spanning a large range of sizes and shapes to assess the consequent modulation of hand posture...The subject was asked to imagine the object floating in space at a distance of ∼40 cm anterior to the subject’s frontal plane. The elbow and wrist rested on a flat surface, the forearm was horizontal, the arm was oriented in the parasagittal plane passing through the shoulder, and the hand was in a semipronated position. At presentation of a “go” signal, the subject moved the arm and hand as if to grasp and use the named object. A contact switch was released at movement onset. When subjects had attained a static hand posture, they pressed a second switch with their left hand. Each subject performed a total of five trials for each of the objects; all trials were presented in random order."

The above procedure was followed with the following exceptions:

1. The subject was asked to wear a Microsoft Hololens 2 throughout the procedure, and ensure that their entire right hand was in the field of view before confirming task completion.
2. No contact switch was used at movement onset.
3. The spacebar on a keyboard was pressed with the left hand to indicate completion of the task.
4. Three (not five) trials were presented for each object.

The list of objects presented in Table 1 of the paper was used without modification.
<!--Can quote directly from original article - just put the text in quotations and note that this was followed precisely.  Or, quote directly and just point out exceptions to what was described in the original article.-->

<!--Protocol for own reference
Print out randomized lists for each participant, with serial numbers. In the spreadsheet, col M is original, then there are six randomized lists N-S starting with tennis racket, rope, chalk, dictionary, circular ashtray and espresso cup. Bis a list of random numbers that changes everytime. To generate a new list, sort col B in ascending order and allow the sorting to expand to include col A, then paste *values* from col A to a new column.

Explain experiment to participant. Tell them if anything gets messed up just to let you know (then mark it on the sheet when that happened). Timestamps logging is a good thing in the worst case. 
Couldn't get csv out of headset so:
After experiment, paste the data from log file: paste special with comma delimiters, remove blank rows by home>>find and select>go to special>blanks and home>delete>rows. BE VERY CAREFUL.
Keep original log files, original Excel pastes sheets, and one final compiled sheet. Manually fill participantID column in compiled sheet.
-->

### Analysis Plan

The key analysis of interest is the principal component analysis of the static joint angles after the goal pose is achieved. Hence, only one frame of joint angles data was used in the analysis for each trial. 

The joint angles were recorded using a Unity app written for this purpose, with the hand-tracking feature built into the Windows Mixed Reality Toolkit (MRTK). A C# script was written to record joint positions when the participant presses the spacebar on a keyboard, compute joint angles from the positions, and log them to a text file as comma-separated values. The script is available at [https://github.com/psych251/santello1998/blob/main/code/hand_tracking/Assets/logJointData.cs](https://github.com/psych251/santello1998/blob/main/code/hand_tracking/Assets/logJointData.cs). 

The data was placed into Microsoft Office Excel spreadsheets by the following procedure:

1. Before data collection: populating the ParticipantID column manually, and randomizing a list of objects with three instances of each object in the second column (using the Excel RAND() function to assign a random numeric value to each entry, followed by sorting numbers and their accompanying objects in decreasing order); repeating each instance 15 times so that the joint angles can be pasted after data collection;
2. After data collection: manually copying and pasting comma-separated data from the log file into the third column, using the Text Import Wizard to separate trial number, timestamp, joint name, and joint angle into separate columns; selecting and deleting alternate blank rows; replacing perfect zeros (representing failed data capture) with blank cells.

The joint angles estimated from visual tracking were (following the original work):

1. metacarpal-phalangeal (mcp) and proximal interphalangeal (pip) flexion of each of the 4 fingers
2. abduction between the 3 pairs of adjacent fingers
3. mcp flexion, abduction, ip flexion, and rotation of the thumb

Abduction of the thumb was computed as the angle between (a) the metacarpal bone of the index finger, and (b) the projection of the metacarpal bone of the thumb into the plane of the palm. Rotation of the thumb was computed as the angle between the thumb metacarpus and the plane of the palm, defined as positive when the thumb is closer to the ventral side. The plane of the palm, for these two calculations, was defined by its normal vector, which in turn was defined to be perpendicular to both the index and middle finger metacarpal bones. 

The following analysis procedure was followed precisely, except with three trials rather than five:

"For each subject, the five trials per object were first averaged to obtain a total of 57 hand postures. For each sensor, we then subtracted the grand mean computed over the 57 objects (so that the range was centered about 0°). The hand posture for each object was thus characterized as a “waveform” of the values of the 15 sensors (Santello and Soechting, 1997). The principal components (PCs) were then computed from the eigenvalues and eigenvectors of the matrix of the covariance coefficients between each of the 57 waveforms."

<!--Can also quote directly, though it is less often spelled out effectively for an analysis strategy section.  The key is to report an analysis strategy that is as close to the original - data cleaning rules, data exclusion rules, covariates, etc. - as possible.  

**Clarify key analysis of interest here**  You can also pre-specify additional analyses you plan to do.-->

### Differences from Original Study

The replication differed from the original study in that:

1. data was collected using a headset rather than a tracking glove,
2. participant ages belonged to a lower range than the original, and
3. each object was presented three times and not five times.

The conclusions are expected to be robust to these changes. 

<!--Explicitly describe known differences in sample, setting, procedure, and analysis plan from original study.  The goal, of course, is to minimize those differences, but differences will inevitably occur.  Also, note whether such differences are anticipated to make a difference based on claims in the original article or subsequent published research on the conditions for obtaining the effect.-->

### Methods Addendum (Post Data Collection)

You can comment this section out prior to final report with data collection.

#### Actual Sample
  Sample size, demographics, data exclusions based on rules spelled out in analysis plan

#### Differences from pre-data collection methods plan
  Any differences from what was described as the original plan, or “none”.

## Results


### Data preparation

Data preparation following the analysis plan.
	
```{r include=T, eval=T}
###Data Preparation

####Load Relevant Libraries and Functions
library(foreign) # for reading spss formatted data
library(tidyr)
library(dplyr)
library(stringr) # useful for some string manipulation
library(ggplot2)
library(ggrepel)
library(corrr)
library(readxl) # import excel files

####Import data
data_path <- '../pilot/pilotB.xlsx'
d1 = read_excel(data_path, sheet=2)
d1df = data.frame(d1)

#hololens gives data that is easiest to paste in long form

#### Data exclusion / filtering

#### Prepare data for analysis - create columns etc.

handpose_long = select(d1df, -Timestamp_seconds)
handpose_wide_raw = pivot_wider(handpose_long, names_from = Joint, values_from = Angle_degrees)

#average over repeated trials
handpose_means =  handpose_long %>% 
  group_by(ParticipantID, Object, Joint) %>%
  summarise(Mean_angle_degrees = mean(Angle_degrees, na.rm = TRUE)) %>% #this will find mean over trials for given participant and object
  ungroup()

#wide format for all participants
handpose_wide_processed_uncentered = handpose_means %>%
  group_by(ParticipantID)%>%
  pivot_wider(names_from = "Object", values_from = "Mean_angle_degrees")%>%
  ungroup

#wide format for all participants, centered around mean for each joint angle calculated over objects
handpose_wide_processed_all <-
  data.frame(ParticipantID = handpose_wide_processed_uncentered$ParticipantID, Joint = handpose_wide_processed_uncentered$Joint,
  select(handpose_wide_processed_uncentered, -c(ParticipantID, Joint))-rowMeans(select(handpose_wide_processed_uncentered, -c(ParticipantID, Joint)), na.rm = TRUE))

```

### Confirmatory analysis

The single statistical test that justifies the main inference of the paper is whether the amount of variation accounted for by the first two principal components together exceeds 80%.

```{r, include=T, eval=T}

#split data into participants for individual analysis
datalist = split(handpose_wide_processed_all, f= handpose_wide_processed_all$ParticipantID)

njoints = length(unique(handpose_long$Joint)) #number of joints
nobj = length(unique(handpose_long$Object)) #number of objects
npart = length(unique(handpose_long$ParticipantID)) #number of participants

#outputs to compare
pva_list <- vector(mode = "list", length = npart) #list of vectors containing percent variation explained by each component
coeffs_list <- data.frame(Participant = rep(as.factor(c(1:npart)), each=nobj), Object =  rep(as.character(NA), times=npart*nobj), PC1 = rep(NA, times=npart*nobj), PC2 = rep(NA, times=npart*nobj))  #dataframe containing coefficients of PC1 and PC2 for each object and participant (for plotting)
checkcoeffs = vector(mode = "list", length = npart) #should contain values close to zero if calculations ran correctly 

#do PCA for each participant
for(i in 1:npart){
handpose_wide_processed = as.data.frame(datalist[[i]]) #get data for ith participant in a dataframe

#set row and column names
colnames(handpose_wide_processed) = colnames(handpose_wide_processed_all)
row.names(handpose_wide_processed) <- handpose_wide_processed$Joint

#keep only joint angles in the data, remove columns where data is missing (possible if all trials for an object failed)
handpose_wide_processed <- handpose_wide_processed %>%
  select(-c(ParticipantID, Joint)) %>%
    select_if(~ !any(is.na(.)))

handpose_wide_transposed = t(handpose_wide_processed)
  
#eigenvalues and eigenvectors of covariance matrix
jointscov = cov(handpose_wide_transposed)
eigvals = eigen(jointscov)$values 
eigvecs = eigen(jointscov)$vectors

#create array to store joint vectors for objects expressed in PC basis
df_coeffs <- as.data.frame(handpose_wide_transposed-handpose_wide_transposed)
colnames(df_coeffs) <- c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10","PC11", "PC12", "PC13", "PC14","PC15")

#actual number of objects for which data was captured for this participant  
nobj_i = ncol(handpose_wide_processed)

#fill in coefficients of each PC for each object for this participant
for (objnumber in 1:nobj_i){
  for (pcnumber in 1:njoints) {
  df_coeffs[objnumber,pcnumber] <- sum(eigvecs[,pcnumber]*handpose_wide_processed[,objnumber])
  }
}

start = nobj_i*(i-1)+1
end = nobj_i*i
coeffs_list$Object[start:end] <- rownames(df_coeffs)
coeffs_list$PC1[start:end] <- df_coeffs[,1]
coeffs_list$PC2[start:end] <- df_coeffs[,2]

#check -- this should be close to zero in each entry, it is the object data minus the appropriate linear combination of PCs for that object with the calculated coefficients
df_check <- as.data.frame(handpose_wide_processed)
for (objnumber in 1:nobj_i){
  for (pcnumber in 1:njoints) {
  df_check[,objnumber] <- df_check[,objnumber] - df_coeffs[objnumber, pcnumber]*eigvecs[,pcnumber]
  }
}

#frobenius norm will be close to zero only if all entries are close to zero as they should be
checkcoeffs[[i]] = norm(data.matrix(df_check), "f")

# Proportion of variance explained by each principal component
pva_list[[i]] <- eigvals / sum(eigvals)

}

#plot cumulative proportion of variance explained by PCs for all participants
xValue <- 1:njoints
dfplot <- data.frame(Participant = rep(as.factor(c(1:npart)), each=njoints), xValue,c(cumsum(pva_list[[1]]), cumsum(pva_list[[2]])))
colnames(dfplot)<-c("Participant", "PC", "Percent_variance_explained")

vp <- ggplot(dfplot, aes(x = PC, y= Percent_variance_explained, group = Participant, color=Participant)) +
  geom_line() +ggtitle("Cumulative Proportion of Variance Explained")+
  geom_point() + ylab("Cumulative Proportion of Variance Explained") + scale_x_discrete(name="Principal Component", limits = colnames(df_coeffs)) + theme_minimal()+theme(legend.position="top") # + ylim(0, 1)

vp

#plot objects in the PC1-PC2 space for all participants
theme<-theme(panel.background = element_blank(),panel.border=element_rect(fill=NA),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),strip.background=element_blank(),axis.text.x=element_text(colour="black"),axis.text.y=element_text(colour="black"),axis.ticks=element_line(colour="black"),plot.margin=unit(c(1,1,1,1),"line"))

coeffs_list<- na.omit(coeffs_list)
                                                                                                               
p<-ggplot(coeffs_list,aes(x=PC1, y=PC2, group = Participant))
p<-p+geom_point()+ geom_text_repel(size=2, label=coeffs_list$Object, max.overlaps = Inf)+theme+facet_wrap(Participant~., ncol=2, labeller = label_both)
p

#AFTER DATA COLLECTION, some of the axes of PC plots may need to be flipped just to make visual comparison easier (sign of eigenvector doesn't matter to the analysis)

```
![Plot of objects in the PC1/PC2 plane from the original paper (Fig. 7)](fig7_santello1998.jpg)

<!--The analyses as specified in the analysis plan.-->

*Side-by-side graph with original graph is ideal here*

###Exploratory analyses

Any follow-up analyses desired (not required).  

## Discussion

### Summary of Replication Attempt

Open the discussion section with a paragraph summarizing the primary result from the confirmatory analysis and the assessment of whether it replicated, partially replicated, or failed to replicate the original result.  

### Commentary

Add open-ended commentary (if any) reflecting (a) insights from follow-up exploratory analysis, (b) assessment of the meaning of the replication (or not) - e.g., for a failure to replicate, are the differences between original and present study ones that definitely, plausibly, or are unlikely to have been moderators of the result, and (c) discussion of any objections or challenges raised by the current and original authors about the replication attempt.  None of these need to be long.
